#echo "ENTER Fallback"
FALLBACK_IP="192.168.10.1"
if [ "$interface" == "eth1" ]
then
		if [ -f "/var/run/dnsmasq.pid" ]
		then
		        logger "Shutting down dnsmasq on eth1"
		        /etc/init.d/dnsmasq stop
		fi
fi

if [ "$reason" == "TIMEOUT" ] && [ "$interface" == "eth1" ] && [ "$new_ip_address" == $FALLBACK_IP ]
then
	logger "DHCP timeout detected. Using fallback ip ($FALLBACK_IP)"
	if [ -f "/var/run/dnsmasq.pid" ]
	then
          echo "dnsmasq already running"
	else
          # dnsmasq not running, start it.
          logger "Starting dnsmasq on eth1"
          /etc/init.d/dnsmasq start
	fi
 	# remove defaule route on internal net to have default gw on eth0
	logger "Removing default route on eth1"
	route del default gw 192.168.10.1
fi
